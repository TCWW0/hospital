# 医联体转诊流程操作指南

本指南总结了当前前端原型（`medical-union-front`）中，社区医生与专科医生围绕双向转诊业务的主要操作路径，以及最新的界面优化行为，便于后续演示与联调。

## 1. 场景概览

- **入口页面**：`http://localhost:8091/doctor/referrals`
- **核心角色**：
  - 社区医生（默认路由中通过 `useDoctorRole()` 切换）
  - 专科医生（协和医院内分泌/心内示例账号）
- **数据来源**：基于 `localStorage` 的 mock API（键名：`medical_union_referrals_v2`）。刷新页面后仍保留最新一次的模拟数据。

## 2. 操作流程速览

### 2.1 社区医生发起转诊

1. 点击“新建上转单”，选择患者与目标专科。
2. 填写转诊摘要、标签、注意事项等信息后提交。
3. 在抽屉的“社区操作”标签中：
   - 提交“患者交接说明”（记录家属沟通要点/携带资料等）。
   - 转诊完成后可补充“社区随访”记录。

### 2.2 专科医生接诊与反馈

1. 在“审核处理”标签中查看社区发起的申请，可“确认接收”或“退回申请”。
2. 根据转诊类型填写“诊疗反馈”（门诊/住院）或上传下转单附件。
3. 处理完成后状态会更新，并推动后续社区随访节点。

### 2.3 社区医生闭环随访

1. 在“申请信息”中确认专科反馈和诊疗总结。
2. 回到“社区操作”标签，新增随访记录并维护患者恢复情况。
3. 系统会将随访记录附加于时间线及申请信息中，便于跨院沟通。

## 3. 最新界面调整要点

- **转诊卡片分页**：列表一次仅展示 3 条在途转诊，底部分页可切换历史记录；提示文案中明确“仅展示最新三条”。
- **抽屉内容自适应高度**：抽屉主体占满剩余视口，滚动区域自动填充，避免出现空白带。
- **“社区操作”视觉强化**：新增渐变背景、按钮高亮、表单控件强调，突出交接说明与随访的重要性。

## 4. 角色与过滤器逻辑

- 社区医生默认锁定“上转”方向；专科医生可以查看全部方向。
- 状态排序按业务阶段（待处理 → 接收 → 诊疗中 → 已随访 → 已拒绝）。
- 搜索栏支持按患者姓名、医院、标签关键字模糊检索。

## 5. 数据刷新策略

- 所有操作会通过 mock API 更新 `localStorage`，触发 `fetchReferrals()` 自动刷新当前分页数据。
- 抽屉内按钮完成后会调用 `reloadCurrentReferral()` 获取最新详情，确保时间线、交接说明实时同步。

## 6. 常见问题排查

| 问题 | 可能原因 | 解决建议 |
| ---- | -------- | -------- |
| 转诊列表为空 | 过滤条件过窄 | 点击“重置”按钮或检查分页是否在空页 |
| 抽屉内容不滚动 | 浏览器缓存旧样式 | 强制刷新（`Ctrl+F5`）或清除缓存后重试 |
| 交接说明未同步 | 未完成保存 | 提交后可在“申请信息”→“患者交接说明”查看确认 |

## 7. 后续拓展建议

- 接入真实后端前，可考虑将 `mock` 层替换为 MSW / Mirage 等工具支持网络请求录制。
- 根据后续业务梳理，将“下转单”“随访记录”等接口拆分为独立服务，便于与 HIS 对接。
- 结合本指南内容，在 README 中添加快速演示脚本（例如预置角色切换、种子数据导入）。

---
若需补充更多场景或更新交互方案，可在本文件中追加章节并同步团队成员。