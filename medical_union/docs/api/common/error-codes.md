# 错误代码说明

## 概述

Medical Union系统采用标准化的错误代码体系，便于问题定位、错误处理和系统维护。本文档详细说明了所有错误代码的含义和处理方式。

---

## 错误码体系设计

### 编码规则

错误码采用**4位数字**格式：`ABCD`

- **A**: 模块标识 (0-9)
- **BCD**: 具体错误编号 (000-999)

### 模块分类


| 模块代码 | 模块名称   | 错误码范围 | 描述                     |
| -------- | ---------- | ---------- | ------------------------ |
| 0        | 通用成功   | 0          | 操作成功                 |
| 1        | 系统级错误 | 100-199    | 系统、网络、基础服务错误 |
| 1        | 认证模块   | 1000-1999  | 用户认证、授权相关       |
| 2        | 患者模块   | 2000-2999  | 患者业务相关             |
| 3        | 医生模块   | 3000-3999  | 医生业务相关             |
| 4        | 预约模块   | 4000-4999  | 预约挂号相关             |
| 5        | 支付模块   | 5000-5999  | 支付交易相关             |
| 6        | 药品模块   | 6000-6999  | 药品管理相关             |
| 7        | 检查模块   | 7000-7999  | 医学检查相关             |
| 8        | 报告模块   | 8000-8999  | 检查报告相关             |
| 9        | 系统管理   | 9000-9999  | 数据库相关错误           |

---

## 通用错误码 (0-199)

### 成功状态


| 错误码 | 描述     | HTTP状态码 | 处理建议         |
| ------ | -------- | ---------- | ---------------- |
| 0      | 操作成功 | 200/201    | 继续处理业务逻辑 |

### 系统级错误 (100-199)


| 错误码 | 描述             | HTTP状态码 | 处理建议               |
| ------ | ---------------- | ---------- | ---------------------- |
| 100    | 系统维护中       | 503        | 显示维护公告，稍后重试 |
| 101    | 服务不可用       | 503        | 检查服务状态，稍后重试 |
| 102    | 数据库连接失败   | 500        | 联系技术支持           |
| 103    | 缓存服务异常     | 500        | 降级处理，联系技术支持 |
| 104    | 外部服务调用失败 | 502        | 重试或降级处理         |
| 105    | 系统超时         | 504        | 减少请求频率，优化请求 |
| 110    | 请求频率过高     | 429        | 减少请求频率           |
| 111    | IP被限制         | 403        | 联系管理员解除限制     |
| 120    | 参数格式错误     | 400        | 检查请求参数格式       |
| 121    | 请求体过大       | 413        | 减少请求数据量         |
| 122    | 不支持的媒体类型 | 415        | 检查Content-Type       |
| 130    | 内部服务异常     | 500        | 联系技术支持           |
| 131    | 配置加载失败     | 500        | 联系技术支持           |

---

## 认证模块错误码 (1000-1999)

### 用户注册相关 (1000-1099)


| 错误码 | 描述             | HTTP状态码 | 处理建议                         |
| ------ | ---------------- | ---------- | -------------------------------- |
| 1001   | 用户名已存在     | 409        | 提示用户使用其他用户名           |
| 1002   | 手机号已被注册   | 409        | 提示用户使用其他手机号或找回账户 |
| 1003   | 邮箱已被注册     | 409        | 提示用户使用其他邮箱或找回账户   |
| 1004   | 用户名格式不正确 | 400        | 提示正确的用户名格式             |
| 1005   | 密码强度不够     | 400        | 提示密码强度要求                 |
| 1006   | 手机号格式不正确 | 400        | 提示正确的手机号格式             |
| 1007   | 邮箱格式不正确   | 400        | 提示正确的邮箱格式               |
| 1008   | 验证码错误       | 400        | 提示重新获取或输入验证码         |
| 1009   | 验证码已过期     | 400        | 提示重新获取验证码               |
| 1010   | 注册失败         | 500        | 联系技术支持                     |

### 用户登录相关 (1100-1199)


| 错误码 | 描述             | HTTP状态码 | 处理建议                     |
| ------ | ---------------- | ---------- | ---------------------------- |
| 1101   | 用户不存在       | 404        | 提示用户先注册或检查输入信息 |
| 1102   | 密码错误         | 401        | 提示用户检查密码             |
| 1103   | 用户类型不匹配   | 403        | 提示选择正确的用户类型登录   |
| 1104   | 账户已被锁定     | 423        | 提示联系管理员解锁           |
| 1105   | 账户已被禁用     | 423        | 提示联系管理员               |
| 1106   | 密码已过期       | 403        | 引导用户修改密码             |
| 1107   | 登录失败次数过多 | 429        | 提示等待或找回密码           |
| 1108   | 需要二次验证     | 202        | 引导用户进行二次验证         |
| 1109   | 异地登录需要验证 | 202        | 发送验证短信                 |
| 1110   | 登录会话冲突     | 409        | 提示是否强制登录             |

### JWT令牌相关 (1200-1299)


| 错误码 | 描述          | HTTP状态码 | 处理建议                |
| ------ | ------------- | ---------- | ----------------------- |
| 1201   | Token缺失     | 401        | 引导用户重新登录        |
| 1202   | Token格式错误 | 401        | 清除本地token，重新登录 |
| 1203   | Token已过期   | 401        | 自动刷新token或重新登录 |
| 1204   | Token签名无效 | 401        | 清除本地token，重新登录 |
| 1205   | Token已被撤销 | 401        | 提示重新登录            |
| 1206   | Token刷新失败 | 401        | 重新登录                |
| 1207   | 非法Token     | 401        | 清除本地token，重新登录 |
| 1208   | Token权限不足 | 403        | 提示权限不够            |

### 权限相关 (1300-1399)


| 错误码 | 描述           | HTTP状态码 | 处理建议               |
| ------ | -------------- | ---------- | ---------------------- |
| 1301   | 权限不足       | 403        | 提示联系管理员申请权限 |
| 1302   | 角色权限不匹配 | 403        | 检查用户角色           |
| 1303   | 资源访问被拒绝 | 403        | 提示无权访问此资源     |
| 1304   | 操作权限不足   | 403        | 提示无权执行此操作     |
| 1305   | 管理员权限需要 | 403        | 提示需要管理员权限     |

---

## 患者模块错误码 (2000-2999)

### 患者信息相关 (2000-2099)


| 错误码 | 描述               | HTTP状态码 | 处理建议                   |
| ------ | ------------------ | ---------- | -------------------------- |
| 2001   | 患者信息不存在     | 404        | 提示完善患者信息           |
| 2002   | 身份证号格式错误   | 400        | 提示正确的身份证格式       |
| 2003   | 身份证号已被使用   | 409        | 提示该身份证已关联其他账户 |
| 2004   | 病历号不存在       | 404        | 检查病历号是否正确         |
| 2005   | 患者年龄不符合要求 | 400        | 提示年龄限制               |

### 就诊卡相关 (2100-2199)


| 错误码 | 描述           | HTTP状态码 | 处理建议       |
| ------ | -------------- | ---------- | -------------- |
| 2101   | 就诊卡不存在   | 404        | 提示办理就诊卡 |
| 2102   | 就诊卡已过期   | 400        | 提示续费就诊卡 |
| 2103   | 就诊卡余额不足 | 400        | 提示充值       |
| 2104   | 就诊卡已挂失   | 400        | 提示联系客服   |

---

## 医生模块错误码 (3000-3999)

### 医生信息相关 (3000-3099)


| 错误码 | 描述             | HTTP状态码 | 处理建议           |
| ------ | ---------------- | ---------- | ------------------ |
| 3001   | 医生信息不存在   | 404        | 检查医生ID         |
| 3002   | 医生执业证书无效 | 400        | 更新执业证书信息   |
| 3003   | 医生未通过审核   | 403        | 等待审核或补充材料 |
| 3004   | 医生已离职       | 410        | 提示医生已不在职   |

### 排班相关 (3100-3199)


| 错误码 | 描述           | HTTP状态码 | 处理建议               |
| ------ | -------------- | ---------- | ---------------------- |
| 3101   | 医生无排班信息 | 404        | 提示选择其他医生或时间 |
| 3102   | 排班时间冲突   | 409        | 调整排班时间           |
| 3103   | 排班已停诊     | 400        | 提示停诊信息           |

---

## 预约模块错误码 (4000-4999)

### 预约挂号相关 (4000-4099)


| 错误码 | 描述         | HTTP状态码 | 处理建议         |
| ------ | ------------ | ---------- | ---------------- |
| 4001   | 预约号源不足 | 400        | 提示选择其他时间 |
| 4002   | 重复预约     | 409        | 提示已有预约     |
| 4003   | 预约时间已过 | 400        | 提示选择未来时间 |
| 4004   | 取消预约超时 | 400        | 提示取消时间限制 |
| 4005   | 预约不存在   | 404        | 检查预约信息     |

---

## 支付模块错误码 (5000-5999)

### 支付相关 (5000-5099)


| 错误码 | 描述           | HTTP状态码 | 处理建议         |
| ------ | -------------- | ---------- | ---------------- |
| 5001   | 余额不足       | 400        | 提示充值         |
| 5002   | 支付方式不支持 | 400        | 选择其他支付方式 |
| 5003   | 支付超时       | 408        | 重新发起支付     |
| 5004   | 支付失败       | 400        | 检查支付信息     |
| 5005   | 退款失败       | 400        | 联系客服         |

---

## 错误处理最佳实践

### 前端处理建议

```typescript
// 错误处理工具函数
function handleApiError(error: ApiResponse) {
    const { code, message } = error;
  
    // 认证相关错误
    if (code >= 1200 && code <= 1299) {
        // 清除本地token
        localStorage.removeItem('jwt_token');
        // 跳转到登录页
        router.push('/login');
        return;
    }
  
    // 权限错误
    if (code >= 1300 && code <= 1399) {
        showMessage('权限不足，请联系管理员', 'warning');
        return;
    }
  
    // 业务错误
    if (code >= 1000) {
        showMessage(message, 'error');
        return;
    }
  
    // 系统错误
    if (code >= 100) {
        showMessage('系统异常，请稍后重试', 'error');
        return;
    }
}
```

### 后端错误处理

```java
// 自定义业务异常
public class BizException extends RuntimeException {
    private final int code;
    private final String message;
    private final HttpStatus httpStatus;
  
    public BizException(ErrorCode errorCode) {
        this.code = errorCode.getCode();
        this.message = errorCode.getMessage();
        this.httpStatus = errorCode.getHttpStatus();
    }
}

// 错误码枚举
public enum ErrorCode {
    USER_NOT_FOUND(1101, "用户不存在", HttpStatus.NOT_FOUND),
    INVALID_PASSWORD(1102, "密码错误", HttpStatus.UNAUTHORIZED),
    TOKEN_EXPIRED(1203, "Token已过期", HttpStatus.UNAUTHORIZED);
  
    private final int code;
    private final String message;
    private final HttpStatus httpStatus;
}
```

---

## 错误监控和日志

### 日志记录规范

```java
// 错误日志示例
logger.error("用户登录失败 - 用户ID: {}, 错误码: {}, 错误信息: {}, IP: {}", 
    userId, errorCode, errorMessage, clientIp);

// 系统错误日志
logger.error("系统异常 - 错误码: {}, 堆栈信息: ", errorCode, exception);
```

### 监控指标

1. **错误率统计**: 按错误码统计各类错误的发生频率
2. **响应时间**: 监控各API的响应时间
3. **错误分布**: 分析错误在不同时间段的分布
4. **用户影响**: 统计错误对用户操作的影响

---

## 更新日志


| 版本   | 日期       | 更新内容                     |
| ------ | ---------- | ---------------------------- |
| v1.0.0 | 2025-09-24 | 初始版本，定义基础错误码体系 |

---

## 联系信息

如需添加新的错误码或修改现有错误码，请联系：

- 📧 Email: dev@medicalunion.com
- 📱 电话: 400-xxx-xxxx
- 🔄 变更流程: 提交错误码变更申请 → 技术评审 → 文档更新 → 系统发布

---

📝 **重要提醒**:

1. 新增错误码需要按照模块分类规则分配
2. 修改现有错误码需要考虑向后兼容性
3. 所有错误码变更都需要同步更新本文档
