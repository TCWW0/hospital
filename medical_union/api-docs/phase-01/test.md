# 远程医疗模块串行测试手册

> 目标：在 **单个浏览器实例** 中依次切换角色，完整走通“申请 → 审核排期 → 患者确认 → 远程诊断 → 报告 → 患者评价 → 管理员归档”的闭环，并验证关键提示与数据同步。

---

## 0. 测试约束与假设

- **单浏览器原则**：所有角色均在同一浏览器中操作，避免 `localStorage` 同步冲突。
- **不同标签/窗口**：同一浏览器内可开多个标签，但执行步骤需串行，避免两个角色同时操作带来状态错判。
- **数据来源**：模块使用 `localStorage` 持久化 + `BroadcastChannel` 通知，刷新页面不会丢数据。
- **种子数据**：首次访问会自动生成示例记录（张三/李梅/赵云），如需干净环境可清空 `localStorage` 后刷新。

---

## 1. 测试前准备

### 1.1 启动前端
```powershell
cd e:\project\hospital\medical-union-front
npm install
npm run dev
```
默认访问地址 `http://localhost:5173/`。

### 1.2 可选：重置本地数据
1. 打开浏览器开发者工具 → Application → Storage → Local Storage。
2. 删除键 `telemedicine.apps.v1`。
3. 刷新页面，确认示例数据重新生成。

### 1.3 准备标签页
按顺序打开以下 3 个地址（均在同一浏览器内）：
- 管理员：`http://localhost:5173/admin/telemedicine`
- 医生：`http://localhost:5173/doctor/telemedicine`
- 患者：`http://localhost:5173/patient/telemedicine`

---

## 2. 串行测试流程

### 阶段 A：管理员初始检查
1. 在管理员列表确认示例案件展示正常，特别是不同阶段的提示。
2. 暂不操作，后续返回此页观察状态变化。

### 阶段 B：医生创建新申请
1. 切到医生标签 -> “远程”。
2. 点击“新建申请”，填写：
   - 患者：如 `测试患者A / patient-a`
   - 服务类型、协同标签、病情描述、期望方式/时间、附件（可选）
3. 提交后弹出成功提示。
4. 在医生列表确认新卡片出现，状态为“提交申请/待审核”。

### 阶段 C：管理员审核与排期
1. 回到管理员列表 → 找到新申请 → 进入详情。
2. 点击“标记审核中”（状态应从 `applied` → `review`）。
3. 在“审核与排期”表单填写：
   - 专家（随意选择）
   - 会诊方式、日期、时间、会议链接/备注（可选）
4. 点击“提交排期”，成功后状态为 `scheduled`，并提示“等待患者确认”。

### 阶段 D：患者确认参加
1. 切到患者标签 → 列表确认新申请存在。
2. 打开新记录详情。
3. 在“远程诊疗接入”区域点击“确认按时参加”，可填写备注（如“将提前 10 分钟上线”）。
4. 提交后提示成功，页面展示“已确认参加会诊”与时间戳。

### 阶段 E：医生（专家）启动会诊与提交报告
1. 回到医生标签：
   - 切换到“指派给我的”，找到同一案例。
   - 打开详情 → 点击“启动远程诊断（示例）”，状态应变为 `in_consult`，轨迹加入相关记录。
2. 下拉到“填写诊断报告”，填写结论/建议（附件可选）。
3. 提交后状态进入 `report_submitted`，提示“报告已生成”。

### 阶段 F：患者查看报告并评价
1. 切到患者标签，刷新或重新进入详情。
2. 在“专家诊断报告”查看内容。
3. 在“我的评价”区域评分并填写意见（可选），点击“提交评价”。
4. 提交后提示成功，状态升级为 `evaluated`。

### 阶段 G：管理员收尾归档
1. 回到管理员详情页，检查顶部提示已变为“患者评价完成”。
2. 在“流程收尾（管理员填写）”中选择评分、填写备注（可选），提交。
3. 状态应变为 `closed`，轨迹显示“填写远程医疗服务评价并归档”。

---

## 3. 关键验证点

- **状态机顺序**：确认阶段依次为 `applied → review → scheduled → in_consult → report_submitted → evaluated → closed`。
- **跨角色提示**：不同角色页面的提示文案与阶段一致（等待审核、待确认、已确认等）。
- **患者确认**：管理员/医生详情页能看到确认信息；若患者未确认提示保持为“等待患者确认”。
- **处理轨迹**：每一步操作都会写入历史，含角色、动作描述、时间。
- **数据持久性**：刷新页面或关闭标签再打开，流程数据仍存在。
- **同步**：若在另一个标签操作（同浏览器），切换回来或刷新即可看到最新状态。

---

## 4. 复位与补充检查

1. **清空环境**：需要回到初始状态时，删除 `telemedicine.apps.v1` 并刷新。
2. **异常场景可选测试**：
   - 管理员未完成审核，患者/医生是否有合理提示。
   - 患者已确认 → 管理员再次修改排期（重走 D 之前步骤）表现。
   - 多次提交反馈/报告的防重复情况（当前版本会覆盖记录，可列为优化项）。
3. **记录改进建议**：测试过程中发现的 UI/文案/流程问题及时记录，便于后续迭代。

---

执行完以上步骤，即可验证远程医疗模块在单浏览器串行操作下的完整闭环流程，并评估各节点是否存在缺口或体验问题。