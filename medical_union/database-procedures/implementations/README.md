# 存储过程实现说明

## 概述
此目录用于存放Auth模块存储过程的具体实现文件。请按照specifications目录中的规范文档进行实现。

## 需要实现的文件

### 1. sp_user_register.sql
**功能**：用户注册存储过程
**参考模板**：`../specifications/sp_user_register_template.sql`
**关键要求**：
- 严格按照接口规范实现输入输出参数
- 实现完整的参数验证逻辑
- 处理用户名、身份证号、手机号的唯一性检查
- 使用统一的错误码体系

### 2. sp_user_login.sql  
**功能**：用户登录验证存储过程
**参考模板**：`../specifications/sp_user_login_template.sql`
**关键要求**：
- 支持用户名和手机号两种登录方式
- 返回密码哈希值供Java端验证
- 包含辅助的登录时间更新存储过程
- 实现用户类型匹配验证

### 3. sp_user_get_info.sql
**功能**：用户信息查询存储过程  
**参考模板**：`../specifications/sp_user_get_info_template.sql`
**关键要求**：
- 实现用户信息的完整查询
- 支持敏感信息脱敏处理
- 包含批量查询的扩展功能
- 优化查询性能

## 实现要求

### 1. 接口契约
- 必须严格按照 `auth-procedures-spec.md` 中定义的接口实现
- 输入输出参数的类型、长度、含义必须完全一致
- 错误码必须使用 `error-codes.md` 中定义的标准错误码

### 2. 业务逻辑
- 参考 `implementation-requirements.md` 中的业务需求详解
- 实现完整的数据验证逻辑
- 确保数据的一致性和完整性

### 3. 错误处理
- 使用模板中提供的统一错误处理框架
- 捕获所有可能的异常并返回适当的错误码
- 确保事务的正确回滚

### 4. 性能要求
- 单个存储过程执行时间 < 100ms
- 合理使用索引，避免全表扫描
- 优化SQL查询语句

### 5. 安全要求
- 防止SQL注入攻击
- 敏感信息的适当处理
- 权限控制和访问限制

## 测试要求

### 1. 功能测试
每个存储过程都需要测试以下场景：
- 正常业务流程
- 各种异常情况
- 边界条件处理
- 错误码返回验证

### 2. 性能测试
- 单次调用性能测试
- 并发调用压力测试
- 大数据量场景测试

### 3. 安全测试
- SQL注入攻击测试
- 权限控制测试
- 数据泄露风险测试

## 提交要求

### 1. 文件命名
- 使用规范中定义的存储过程名称
- 文件扩展名为 `.sql`
- 文件编码为 UTF-8

### 2. 代码规范
- 使用清晰的注释说明业务逻辑
- 合理的代码缩进和格式
- 变量命名规范统一

### 3. 文档说明
- 在每个SQL文件开头添加详细的注释
- 说明实现的业务逻辑和关键技术点
- 提供使用示例和测试案例

## 验收标准

### 功能验收
- [ ] 所有接口参数严格按规范实现
- [ ] 业务逻辑完整正确
- [ ] 错误处理机制完善
- [ ] 错误码返回准确

### 性能验收
- [ ] 执行时间满足要求
- [ ] 并发性能达标
- [ ] 资源使用合理

### 安全验收
- [ ] 通过SQL注入测试
- [ ] 敏感信息保护到位
- [ ] 权限控制正确

## 交付流程

1. **实现完成**：在此目录下创建对应的SQL文件
2. **自测验证**：使用提供的测试用例进行验证
3. **提交通知**：通知Java端开发人员进行集成
4. **集成测试**：配合进行端到端测试
5. **问题修复**：根据测试结果进行必要调整

## 注意事项

1. **密码处理**：登录存储过程只查询用户信息，密码验证由Java端完成
2. **JSON处理**：充分利用MySQL的JSON函数处理profile字段
3. **事务管理**：确保每个存储过程的事务完整性
4. **索引优化**：确保相关表已建立适当的索引

---

**实现完成后，请在此处更新实现说明和测试结果，方便后续维护。**